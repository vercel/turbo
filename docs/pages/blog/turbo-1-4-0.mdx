---
title: Turborepo 1.4
date: 2022/07/29
description: Turborepo 1.4 has new examples, introduces the Turborepo Agent, automatically includes environment variables, and more!
tag: web development
ogImage: /images/blog/turbo-1-4-0/og-image.png
---

# Turborepo 1.4

import { Authors } from '../../components/Authors'
import Callout from '../../components/Callout'

<div className="text-sm mt-2 text-center text-gray-500 dark:text-gray-400">Thursday, July 28th, 2022</div>

<Authors authors={[ 'gsoltis', 'nathanhammond', 'tknickman', 'anthonyshewdev', ]} />

Turborepo 1.4 lays the foundation for the future of Turborepo.

- [**Automatic environment variable inclusion:**](#automatic-environment-variable-inclusion) We'll find popular framework environment variables for you. No need to add them yourself.
- [**Turborepo Agent:**](#the-turborepo-agent) A daemon to make your local building experience faster - while you're not even looking.
- [**New framework and library examples:**](#new-framework-and-library-examples) We've added _even more_ starters that the community has requested.

Update today by running `npm install turbo@latest`.

## Automatic environment variable inclusion

One of the easiest mistakes to make when setting up Turborepo is accidentally omitting an important environment variable resulting in reusing a cache somewhere you didn't expect. Turborepo now has your back and will detect commonly used environment variables to help you avoid this problem. We already include support for the following tools and frameworks: Astro, Blitz, Create React App, Gatsby, Next.js, Nuxt, RedwoodJS, Sanity, Solid, SvelteKit, Vite, and Vue.js.

## Our journey towards instant builds

Turborepo aims to make your builds as fast as possible while staying out of your way. When you say "run this build," it should be instant.

But there's a problem: Turborepo handles many file operations—and those add up! For example, it takes .008 milliseconds to `touch` a file (which is a decent approximation of the minimum work to write a file (`fopen`, `fwrite`, `fclose`)). While that seems fast, once your build contains thousands of files those .008 milliseconds start to accumulate quickly.

![Timing of an execution of touch, demonstrating it taking .008ms to create a file.](/images/blog/turbo-1-4-0/time-dark.png)

We have a long list of things we want to bring you—but all of them require the existence of _one thing_.

## The Turborepo Agent

The Turborepo Agent (also known as a daemon) is a background process that works on your behalf to perform system chores. Behind the scenes, the Turborepo Agent will work with the `turbo` main process to offload work that can be done either in advance or later.

This is one of the most significant Turborepo features we have ever built and it will simply, silently, improve your day-to-day local build experience. To opt into usage today:

```bash
turbo run build --experimental-use-daemon
```

Turborepo is already pretty fast so you may not be able to feel the difference right away. To find the optimizations you've just enabled, you'll also need to add the `-vv` flag for verbose logging. Anywhere in your logs that you see `Skipping cache check for <TASK>, outputs have not changed since previous run.`, the Turborepo Agent just got you building faster.

<Callout>
Running on macOS and wondering why this change doesn't seem to make any difference? [Apple has optimized their file system operations to do the work when nobody is watching.](https://twitter.com/marcan42/status/1494213862970707969) Clever, Apple. We see you.
</Callout>

## How it works

A Turborepo build spends the majority of its time handling system calls, so small performance cuts add up. For large builds, system calls can account for as much as 82% of Turborepo's entire execution time.

![Flamechart of a Turborepo build showing the majority of the time spent at the leaf nodes in system calls.](/images/blog/turbo-1-4-0/flamechart.png)

_As a general rule, any flame chart where you can read the full name of a function call is a bad one._

So, what should we do?

### Make it faster?

The most obvious solution is to just do things faster. But there's a problem here: we're limited by system call performance.

Turborepo must use the system calls from your operating system and can't reach into that code to make it faster. Luckily, OS code is already super-optimized - but it is still the lower bound of how fast we can make Turborepo run.

### Do less work?

Turborepo's job is to move files around your system. We already optimize our code to avoid unnecessarily processing files, and, as we continue to improve Turborepo, we will approach the absolute minimum amount of work needed to accomplish the tasks we're responsible for.

While we can minimize the amount of work that _our_ code does, Turborepo is for handling _your_ code. If your build is asking Turborepo to do tons of work, we need to do the work that you ask of us!

And, since the work for your build is the driving factor of how much work needs to be done, we can't cut corners there.

### Do the work when nobody is watching.

So, if we can't make it faster and we can't do less work, the best way we can make things _feel_ faster is to do the work when nobody is watching. What if Turborepo could do all of the work that you care about right now and then handle all of the bookkeeping later?

## Agents for change

Now that we have the Turborepo Agent, we're excited to be able to continue improving your build experience in the future. There are two major categories of performance-improvement opportunities that we see it enabling:

- Filesystem monitoring
- Cache management

### Filesystem monitoring

Right now, the Turborepo Agent has been given just one job: monitor the output locations of tasks. But having filesystem monitoring in place enables additional opportunities with tracking of task inputs to precompute task hashes and perform differential cache restoration.

### Cache management

The last step of any Turborepo build is to store the build outputs with the remote cache. Depending on your network connection this can be either near-instantaneous or prohibitively slow. We plan to hand that job off to the Turborepo Agent so you'll never have to wait for network calls again.

## Under the hood of Turborepo

Turborepo Agent has been a major effort including decisions about the future architecture of Turborepo.

[![Header of PR which landed the Turborepo Agent.](/images/blog/turbo-1-4-0/pr.png)](https://github.com/vercel/turborepo/pull/1429)

Now, when you start up `turbo`, the first thing we do is launch the Turborepo Agent. We have to wait for that to happen so we use a binary exponential backoff for our connection attempts. This ensures we get out of the way as quickly as possible so you can start building.

That interprocess communication uses gRPC and protobufs to give us versioning guarantees (both backwards- and forwards-compatible) and quick marshaling of data so that we don't spend all of our time chatting.

`turbo` searches through system environment variables at runtime and prefix matches variable names that we know are associated to these frameworks, for example `NEXT_PUBLIC_`. [The list of environment variables we inspect are located here.](https://github.com/vercel/turborepo/blob/222d2c1a1b846b309c33a20924922baf51d10431/cli/internal/env/env.go#L13-L23)

[You can learn more about about configuring environment variables with Turborepo in our documentation.](https://turborepo.org/docs/core-concepts/caching#alter-caching-based-on-environment-variables-and-files)

## New framework and library examples

Over the past month, we've invested a lot of time in creating new examples for how to integrate Turborepo into your workflow, featuring:

- [Svelte](https://github.com/vercel/turborepo/tree/main/examples/with-svelte)
- [Docker](https://github.com/vercel/turborepo/tree/main/examples/with-docker)
- [Create React App](https://github.com/vercel/turborepo/tree/main/examples/with-create-react-app)
- [React Native](https://github.com/vercel/turborepo/tree/main/examples/with-react-native-web)
- [Prisma](https://github.com/vercel/turborepo/tree/main/examples/with-prisma)
- [Tailwind](https://github.com/vercel/turborepo/tree/main/examples/with-tailwind)
- … [and more!](https://github.com/vercel/turborepo/tree/main/examples)

## Other bug fixes and improvements

- Allow both sides of git comparison. ([#1442](https://github.com/vercel/turborepo/pull/1442))
- Properly rebuild packages that share a name prefix. ([#1538](https://github.com/vercel/turborepo/pull/1538))
- Cache files with the correct file permissions. ([#1429](https://github.com/vercel/turborepo/pull/1429))

## Community

Since releasing [Turborepo v1.3 in June](/blog/turbo-1-3-0), we've seen incredible adoption and community growth:

- [8.5k+ GitHub Stars](https://github.com/vercel/turborepo)
- 325k weekly NPM downloads, up 2x since late April
- 9.5 years of compute time saved through Remote Caching on Vercel, saving 10 months per week

Turborepo is the result of the combined work of all of our contributors including our core team.

This release was brought to you by the contributions of: @B2o5T, @chitchu, @elis, @gsoltis, @harshcut, @jaredpalmer, @kocisov, @nathanhammond, @neolivz, @NuroDev, @oneezy, @samouri, @shayc, @StevenMatchett, @tknickman, @trevorr, @zsoldosp, and more!

Thank you for your continued support, feedback, and collaboration with us and making Turborepo your build tool of choice.
